{"version":3,"sources":["webpack:///./src/SmartComponents/Vulnerability/VulnerabilityCard.js"],"names":["intl","useIntl","chartData","rows","legendLink","dispatch","useDispatch","vulnerabilities","useSelector","DashboardStore","vulnerabilitiesFetchStatus","selectedTags","workloads","SID","strong","str","iconTooltip","text","key","position","TooltipPosition","content","className","columns","title","transforms","textCenter","cellTransforms","formatMessage","messages","fitContent","useEffect","options","SAP","isSelected","sap_system","length","sap_sids","tags","AppActions","bySeverity","cves_by_severity","x","from","to","y","count","fill","data","UI_BASE","map","TableText","wrapModifier","style","href","props","undefined","known_exploits","isFilled","appName","isExpanded","JSON","parse","localStorage","getItem","isExpandedCallback","setItem","body","direction","default","spaceItems","flexWrap","rel","rules_cves_total","cves","string","component","variant","isSmall","exploited_cves_count","tooltip","hasDivider","ariaDesc","cves_total","ariaTitle","constrainToVisibleArea","padding","bottom","left","right","top","colorScale","global_disabled_color_100","Table","borders","cells","gridBreakPoint","TableHeader","TableBody"],"mappings":"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","file":"js/897.22b2d1f695f27e934121.js","sourcesContent":["import './VulnerabilityCard.scss';\n\nimport * as AppActions from '../../AppActions';\n\nimport {\n    Button,\n    TextContent,\n    Tooltip,\n    TooltipPosition\n} from '@patternfly/react-core/dist/esm/components';\nimport { Flex } from '@patternfly/react-core/dist/esm/layouts';\nimport React, { useEffect } from 'react';\nimport { fitContent, Table, TableBody, TableHeader, TableText, textCenter } from '@patternfly/react-table';\nimport { TemplateCard, TemplateCardBody, TemplateCardHeader } from '../../PresentationalComponents/Template/TemplateCard';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { CompoundCard } from '../../PresentationalComponents/Template/CompoundCard';\nimport { ExpandableCardTemplate } from '../../PresentationalComponents/Template/ExpandableCardTemplate';\nimport FailState from '../../PresentationalComponents/FailState/FailState';\nimport InfoIcon from '../../Icons/InfoIcon';\nimport Loading from '../../PresentationalComponents/Loading/Loading';\nimport { PieChart } from '../../ChartTemplates/PieChart/PieChartTemplate';\nimport { UI_BASE } from '../../AppConstants';\nimport global_disabled_color_100 from '@patternfly/react-tokens/dist/esm/global_disabled_color_100';\nimport messages from '../../Messages';\nimport { useIntl } from 'react-intl';\n\nconst VulnerabilityCard = () => {\n    const intl = useIntl();\n    const pieChartPadding = { bottom: 0, left: 0, right: 0, top: 0 };\n    let chartData = [];\n    let rows = [];\n    let legendLink = [];\n    const dispatch = useDispatch();\n    const vulnerabilities = useSelector(({ DashboardStore }) => DashboardStore.vulnerabilities);\n    const vulnerabilitiesFetchStatus = useSelector(({ DashboardStore }) => DashboardStore.vulnerabilitiesFetchStatus);\n    const selectedTags = useSelector(({ DashboardStore }) => DashboardStore.selectedTags);\n    const workloads = useSelector(({ DashboardStore }) => DashboardStore.workloads);\n    const SID = useSelector(({ DashboardStore }) => DashboardStore.SID);\n    const strong = str => <strong>{str}</strong>;\n\n    const iconTooltip = text => <Tooltip\n        key={text}\n        position={TooltipPosition.right}\n        content={<div>{text}</div>}>\n        <span aria-label='Action' className='ins-c-info-icon pf-u-ml-sm'>\n            <InfoIcon />\n        </span>\n    </Tooltip>;\n\n    const columns = [\n        {\n            title: 'CVSS score'\n        },\n        {\n            title: 'CVE totals',\n            transforms: [textCenter],\n            cellTransforms: [textCenter]\n        },\n        {\n            title: (\n                <span>Known exploits{iconTooltip(intl.formatMessage(messages.exploitedCveTooltip))}</span>\n            ),\n            transforms: [fitContent]\n        }];\n\n    useEffect(() => {\n        const options = {\n            ...workloads?.SAP?.isSelected && { sap_system: true },\n            ...SID?.length > 0 && { sap_sids: SID },\n            ...selectedTags?.length > 0 && { tags: selectedTags }\n        };\n        const fetchVulnerabilities = options => dispatch(AppActions.fetchVulnerabilities(options));\n\n        fetchVulnerabilities(options);\n    }, [workloads, SID, selectedTags, dispatch]);\n\n    if (vulnerabilitiesFetchStatus === 'fulfilled') {\n        let { cves_by_severity: bySeverity } = vulnerabilities;\n\n        chartData = [{\n            x: 'CVSS 8.0 - 10',\n            from: 8.0,\n            to: 10.0,\n            y: bySeverity['8to10'].count,\n            fill: '#a30000',\n            data: bySeverity['8to10']\n        },\n        {\n            x: 'CVSS 4.0 - 7.9',\n            from: 4.0,\n            to: 7.9,\n            y: bySeverity['4to7.9'].count,\n            fill: '#ec7a08',\n            data: bySeverity['4to7.9']\n        },\n        {\n            x: 'CVSS 0.0 - 3.9',\n            from: 0.0,\n            to: 3.9,\n            y: bySeverity['0to3.9'].count,\n            fill: '#f0ab00',\n            data: bySeverity['0to3.9']\n        }];\n\n        legendLink = (from, to) => `${UI_BASE}/vulnerability/cves?cvss_from=${from}&cvss_to=${to}`;\n\n        rows = chartData.map(({ data, from, to, fill }) => [{\n            title: <TableText wrapModifier='nowrap' className='ins-c-legend__dot'\n                style={{ '--ins-c-legend__dot--BackgroundColor': `${fill}` }}>\n                <a href={legendLink(from, to)}>{`${from}.0 - ${to}`}</a>\n            </TableText>\n        }, {\n            title: <a href={legendLink(from, to)} className='pf-u-text-align-center'>{data.count}</a>,\n            props: { textCenter: true }\n        }, {\n            title: <a href={legendLink(from, to) + '&known_exploit=true'} className='pf-u-text-align-center'>\n                {data.known_exploits === undefined ? 'N/A' : data.known_exploits}</a>,\n            props: { textCenter: true }\n        }]);\n    }\n\n    if (vulnerabilitiesFetchStatus === 'rejected') {\n        return <TemplateCard isFilled={false} className='ins-c-card__vulnerability' data-ouia-safe>\n            <TemplateCardHeader title={intl.formatMessage(messages.vulnerabilitiesTitle)} />\n            <TemplateCardBody><FailState appName='Vulnerability' /></TemplateCardBody>\n        </TemplateCard>;\n    }\n\n    return <CompoundCard className='ins-c-dashboard-card-parent ins-c-dashboard__card--compound--Vulnerabilities'\n        data-ouia-safe={vulnerabilitiesFetchStatus !== 'pending'}>\n        <ExpandableCardTemplate\n            appName='Vulnerabilities'\n            className='ins-m-toggle-right-on-md ins-m-short-header'\n            data-ouia-safe={vulnerabilitiesFetchStatus !== 'pending'}\n            title={intl.formatMessage(messages.vulnerabilitiesTitle)}\n            isExpanded={JSON.parse(localStorage.getItem('dashboard_expanded_vulnerability1') || 'true')}\n            isExpandedCallback={isExpanded => localStorage.setItem('dashboard_expanded_vulnerability1', isExpanded)}\n            body={vulnerabilitiesFetchStatus === 'fulfilled' ? <TemplateCardBody className='ins-c-dashboard__card--Vulnerabilities__card-body'>\n                <Flex\n                    direction={{ default: 'column' }}\n                    spaceItems={{ default: 'spaceItemsLg' }}\n                    flexWrap={{ default: 'nowrap' }}\n                >\n                    <TextContent\n                        className='ins-c-width-limiter'\n                        style={{ '--ins-c-width-limiter--MaxWidth': '54ch' }}>\n                        <p className='pf-u-font-size-sm'>\n                            {intl.formatMessage(messages.vulnerabilityMessage)}\n                        </p>\n                    </TextContent>\n                    <div className=\"ins-c-dashboard__card--Vulnerabilities--SplitMetrics\">\n                        <div className=\"ins-c-dashboard__card--Vulnerabilities--SplitMetrics__item\">\n                            <div className=\"ins-c-dashboard__card--Vulnerabilities--SplitMetrics__content\">\n                                <a className='pf-u-font-size-2xl pf-u-color-100'\n                                    href={`${UI_BASE}/vulnerability/cves?affecting=true,true&rule_presence=true`}\n                                    rel='noreferrer'>\n                                    {vulnerabilities.rules_cves_total}\n                                </a>\n                                <TextContent>\n                                    <p className='pf-u-font-size-sm'>\n                                        {intl.formatMessage(messages.cvesImpactingOneOrMoreSystems, {\n                                            cves: vulnerabilities.rules_cves_total,\n                                            strong: string => strong(string)\n                                        })}\n                                    </p>\n                                </TextContent>\n                            </div>\n                            <Button component='a' href={`${UI_BASE}/vulnerability/cves?affecting=true,true&rule_presence=true`}\n                                rel='noreferrer'\n                                variant='secondary' isSmall>\n                                {intl.formatMessage(messages.vulnerabilityCardCTAText)}\n                            </Button>\n                        </div>\n                        <div className=\"ins-c-dashboard__card--Vulnerabilities--SplitMetrics__item\">\n                            <div className=\"ins-c-dashboard__card--Vulnerabilities--SplitMetrics__content\">\n                                <a className='pf-u-font-size-2xl pf-u-color-100'\n                                    href={`${UI_BASE}/vulnerability/cves?known_exploit=true&affecting=true,true`} rel='noreferrer'>\n                                    {vulnerabilities.exploited_cves_count}\n                                </a>\n                                <TextContent>\n                                    <p className='pf-u-font-size-sm'>\n                                        {intl.formatMessage(messages.knownExploitsOneOrMoreSystems, {\n                                            cves: vulnerabilities.exploited_cves_count,\n                                            strong: string => strong(string),\n                                            tooltip: () => iconTooltip(intl.formatMessage(messages.exploitedCveTooltip))\n                                        })}\n                                    </p>\n                                </TextContent>\n                            </div>\n                            <Button component='a' href={`${UI_BASE}/vulnerability/cves?known_exploit=true&affecting=true,true`}\n                                rel='noreferrer'\n                                variant='secondary' isSmall>\n                                {intl.formatMessage(messages.vulnerabilityCardKnownExploitsCTAText)}\n                            </Button>\n                        </div>\n                    </div>\n                </Flex>\n            </TemplateCardBody>\n                : <Loading />\n            } />\n        <ExpandableCardTemplate\n            appName='CVESbyCVSS'\n            className='ins-m-toggle-right-on-md'\n            data-ouia-safe={vulnerabilitiesFetchStatus !== 'pending'}\n            title={intl.formatMessage(messages.cveByCvssScoreTitle)}\n            isExpanded={JSON.parse(localStorage.getItem('dashboard_expanded_vulnerability2') || 'true')}\n            isExpandedCallback={isExpanded => localStorage.setItem('dashboard_expanded_vulnerability2', isExpanded)}\n            hasDivider\n            body={vulnerabilitiesFetchStatus === 'fulfilled' ? <TemplateCardBody className='ins-c-cves-by-cvss-card-body pf-u-pt-sm'>\n                <div className=\"ins-c-dashboard__card-chart-container\">\n                    <div className=\"ins-c-dashboard__card-pie-chart\">\n                        <PieChart\n                            ariaDesc={intl.formatMessage(messages.cvesImpactingSystems,\n                                { cves: vulnerabilities.cves_total })}\n                            ariaTitle='Vulnerabilities chart'\n                            constrainToVisibleArea={true}\n                            data={chartData}\n                            padding={pieChartPadding}\n                            colorScale={vulnerabilitiesFetchStatus === 'fulfilled' && vulnerabilities.cves_total === 0 ?\n                                [global_disabled_color_100.value] : ['#a30000', '#ec7a08', '#f0ab00']} />\n                    </div>\n                    <div className=\"ins-c-dashboard__card-pie-chart-legend\">\n                        <Table\n                            borders={false}\n                            aria-label='Simple Table'\n                            cells={columns}\n                            rows={rows}\n                            className='ins-m-no-styling'\n                            gridBreakPoint=''\n                        >\n                            <TableHeader />\n                            <TableBody />\n                        </Table>\n                    </div>\n                </div>\n            </TemplateCardBody>\n                : <Loading />\n            } />\n    </CompoundCard>;\n};\n\nexport default VulnerabilityCard;\n"],"sourceRoot":""}